<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>t-SNE - t-Distributed Stochastic Neighbor Embedding</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        .page-title {
            color: #2c3e50;
            font-weight: 700;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .section-title {
            color: #34495e;
            font-weight: 600;
            margin-top: 30px;
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 3px solid #e74c3c;
            padding-bottom: 10px;
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
        }
        
        .visualization-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .visualization-image {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .nav-link {
            color: #2c3e50;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .nav-link:hover {
            color: #e74c3c;
        }
        
        .beginner-guide {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #e74c3c;
        }
        
        .use-case {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #27ae60;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .intuition-box {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #e17055;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        
        .spinner-border {
            color: #e74c3c;
        }
        
        .comparison-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .comparison-table th {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            font-weight: 600;
            padding: 15px;
        }
        
        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
        
        .parameter-explanation {
            background: linear-gradient(135deg, #ddd6fe, #c4b5fd);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #8b5cf6;
        }
        
        .warning-box {
            background: linear-gradient(135deg, #fed7d7, #feb2b2);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #e53e3e;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <!-- Navigation -->
            <nav class="navbar navbar-expand-lg navbar-light mb-4">
                <div class="container-fluid">
                    <a class="navbar-brand" href="/">
                        <i class="fas fa-chart-line"></i> Dimension Reduction
                    </a>
                    <div class="navbar-nav ms-auto">
                        <a class="nav-link" href="/"><i class="fas fa-home"></i> Home</a>
                        <a class="nav-link" href="/svd"><i class="fas fa-cube"></i> SVD</a>
                        <a class="nav-link" href="/nnmf"><i class="fas fa-layer-group"></i> NNMF</a>
                        <a class="nav-link" href="/pca"><i class="fas fa-compress"></i> PCA</a>
                        <a class="nav-link active" href="/tsne"><i class="fas fa-project-diagram"></i> t-SNE</a>
                    </div>
                </div>
            </nav>

            <h1 class="page-title">
                <i class="fas fa-project-diagram"></i> t-SNE
            </h1>
            <p class="text-center text-muted mb-4">t-Distributed Stochastic Neighbor Embedding</p>

            <!-- Beginner's Guide -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-graduation-cap"></i> Beginner's Guide to t-SNE</h3>
                </div>
                <div class="card-body">
                    <div class="beginner-guide">
                        <h4><i class="fas fa-lightbulb"></i> What is t-SNE?</h4>
                        <p><strong>t-SNE (t-Distributed Stochastic Neighbor Embedding)</strong> is a powerful technique for visualizing high-dimensional data in 2D or 3D. It's like creating a "map" of your data where similar points are close together and different points are far apart.</p>
                        
                        <h5><i class="fas fa-map"></i> Simple Analogy:</h5>
                        <p>Imagine you have 1000 photos and want to arrange them on a wall so that similar photos are near each other. t-SNE is like having a smart assistant that looks at all the photos and arranges them perfectly, putting family photos together, vacation photos together, etc.</p>
                        
                        <h5><i class="fas fa-cogs"></i> How it Works:</h5>
                        <ol>
                            <li><strong>Measure similarities</strong> between all pairs of data points in high dimensions</li>
                            <li><strong>Create probabilities</strong> that represent how likely points are to be neighbors</li>
                            <li><strong>Find a 2D arrangement</strong> where these probabilities are preserved</li>
                            <li><strong>Optimize iteratively</strong> until the 2D map matches the high-dimensional relationships</li>
                        </ol>
                        
                        <h5><i class="fas fa-eye"></i> Real-World Example:</h5>
                        <p>Scientists use t-SNE to visualize gene expression data. With thousands of genes measured in each cell, t-SNE creates a 2D map where cells with similar gene patterns cluster together, revealing cell types and biological relationships!</p>
                    </div>
                </div>
            </div>

            <!-- Intuition Behind t-SNE -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-brain"></i> Intuition Behind t-SNE</h3>
                </div>
                <div class="card-body">
                    <div class="intuition-box">
                        <h4><i class="fas fa-compass"></i> The Core Idea</h4>
                        <p>t-SNE focuses on <strong>preserving local neighborhoods</strong> - keeping similar points close together while pushing dissimilar points apart. It's like creating a "social network map" of your data.</p>
                        
                        <h5><i class="fas fa-users"></i> Neighborhood Preservation:</h5>
                        <ul>
                            <li><strong>Local Structure:</strong> Points that are neighbors in high-D stay neighbors in 2D</li>
                            <li><strong>Global Structure:</strong> Distant points in high-D become distant in 2D</li>
                            <li><strong>Non-linear:</strong> Unlike PCA, t-SNE can handle complex, curved relationships</li>
                            <li><strong>Clustering:</strong> Natural groups in the data become visible clusters</li>
                        </ul>
                        
                        <h5><i class="fas fa-balance-scale"></i> Probability = Similarity:</h5>
                        <p>t-SNE converts distances into probabilities. If two points are very similar (close), they have a high probability of being neighbors. If they're different (far), they have a low probability.</p>
                        
                        <h5><i class="fas fa-magic"></i> The Magic:</h5>
                        <p>t-SNE uses a special "t-distribution" that creates natural clusters and prevents the "crowding problem" - where all points would collapse into the center. This makes clusters more separated and easier to see!</p>
                    </div>
                </div>
            </div>

            <!-- Key Parameters -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-sliders-h"></i> Key Parameters</h3>
                </div>
                <div class="card-body">
                    <div class="parameter-explanation">
                        <h4><i class="fas fa-cog"></i> Perplexity</h4>
                        <p><strong>Perplexity</strong> controls how many neighbors each point considers. It's like adjusting the "zoom level" of your map:</p>
                        <ul>
                            <li><strong>Low Perplexity (5-15):</strong> Focuses on very local structure, creates many small clusters</li>
                            <li><strong>Medium Perplexity (15-30):</strong> Balanced view, good for most datasets</li>
                            <li><strong>High Perplexity (30-50):</strong> Considers more global structure, fewer but larger clusters</li>
                        </ul>
                        
                        <h5><i class="fas fa-chart-line"></i> Learning Rate</h5>
                        <p><strong>Learning Rate</strong> controls how fast the algorithm learns:</p>
                        <ul>
                            <li><strong>Too Low:</strong> Algorithm gets stuck in poor solutions</li>
                            <li><strong>Too High:</strong> Algorithm becomes unstable and chaotic</li>
                            <li><strong>Sweet Spot:</strong> Usually between 10-1000, default is 200</li>
                        </ul>
                        
                        <h5><i class="fas fa-repeat"></i> Iterations</h5>
                        <p><strong>Iterations</strong> determine how long the algorithm runs:</p>
                        <ul>
                            <li><strong>Too Few:</strong> Algorithm doesn't converge, poor visualization</li>
                            <li><strong>Too Many:</strong> Wastes computation time</li>
                            <li><strong>Typical:</strong> 1000-5000 iterations for good results</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Where t-SNE is Used -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-globe"></i> Where is t-SNE Used?</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="use-case">
                                <h5><i class="fas fa-dna"></i> Single-Cell Biology</h5>
                                <p><strong>Cell Type Discovery:</strong> Visualize thousands of cells to identify different cell types and their relationships.</p>
                                <p><strong>Gene Expression:</strong> Map cells based on their gene expression profiles to understand development and disease.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="use-case">
                                <h5><i class="fas fa-image"></i> Computer Vision</h5>
                                <p><strong>Image Clustering:</strong> Group similar images together for content-based image retrieval.</p>
                                <p><strong>Feature Visualization:</strong> Understand what neural networks learn by visualizing their internal representations.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="use-case">
                                <h5><i class="fas fa-chart-line"></i> Machine Learning</h5>
                                <p><strong>Model Debugging:</strong> Visualize high-dimensional model predictions to understand failures.</p>
                                <p><strong>Data Exploration:</strong> Explore complex datasets before applying other machine learning algorithms.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="use-case">
                                <h5><i class="fas fa-microscope"></i> Scientific Research</h5>
                                <p><strong>Climate Data:</strong> Visualize complex climate patterns and identify weather regimes.</p>
                                <p><strong>Astronomy:</strong> Analyze star/galaxy properties to understand cosmic structures.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Important Warnings -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-exclamation-triangle"></i> Important Warnings</h3>
                </div>
                <div class="card-body">
                    <div class="warning-box">
                        <h4><i class="fas fa-warning"></i> What t-SNE is NOT:</h4>
                        <ul>
                            <li><strong>Not a Clustering Algorithm:</strong> t-SNE creates beautiful visualizations but doesn't automatically find clusters</li>
                            <li><strong>Not Deterministic:</strong> Running t-SNE multiple times gives different results - this is normal!</li>
                            <li><strong>Not for Large Datasets:</strong> t-SNE is slow and memory-intensive for datasets with >10,000 points</li>
                            <li><strong>Not Interpretable Distances:</strong> Distances in t-SNE plots don't represent real distances in the original data</li>
                        </ul>
                        
                        <h5><i class="fas fa-check-circle"></i> Best Practices:</h5>
                        <ul>
                            <li><strong>Use for Visualization:</strong> t-SNE is primarily for exploring and visualizing data</li>
                            <li><strong>Try Different Perplexities:</strong> Experiment with different values to see different aspects of your data</li>
                            <li><strong>Run Multiple Times:</strong> Don't trust a single run - run it several times to see consistent patterns</li>
                            <li><strong>Combine with Other Methods:</strong> Use t-SNE for exploration, then apply other methods for analysis</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- t-SNE vs Other Methods -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-balance-scale"></i> t-SNE vs Other Methods</h3>
                </div>
                <div class="card-body">
                    <div class="comparison-table">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Method</th>
                                    <th>Type</th>
                                    <th>Best For</th>
                                    <th>Key Advantage</th>
                                    <th>Limitations</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>t-SNE</strong></td>
                                    <td>Non-linear</td>
                                    <td>Visualization, local structure</td>
                                    <td>Beautiful clusters, preserves neighborhoods</td>
                                    <td>Slow, non-deterministic, not for large data</td>
                                </tr>
                                <tr>
                                    <td><strong>PCA</strong></td>
                                    <td>Linear</td>
                                    <td>Linear relationships, noise reduction</td>
                                    <td>Fast, interpretable, preserves global structure</td>
                                    <td>Only linear relationships</td>
                                </tr>
                                <tr>
                                    <td><strong>UMAP</strong></td>
                                    <td>Non-linear</td>
                                    <td>Visualization, larger datasets</td>
                                    <td>Faster than t-SNE, preserves more global structure</td>
                                    <td>More complex parameters</td>
                                </tr>
                                <tr>
                                    <td><strong>SVD</strong></td>
                                    <td>Linear</td>
                                    <td>Matrix decomposition, compression</td>
                                    <td>Mathematically elegant, handles any matrix</td>
                                    <td>Only linear relationships</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Visual Examples -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-chart-bar"></i> Visual Examples on Random Dataset</h3>
                </div>
                <div class="card-body">
                    <p class="mb-4">Let's see how t-SNE works on a random dataset with clusters. We'll apply t-SNE with different perplexity values to see how it affects the visualization.</p>
                    
                    <div class="text-center mb-4">
                        <button class="btn btn-primary btn-lg" onclick="loadTSNERandomExample()">
                            <i class="fas fa-play"></i> Generate Random t-SNE Examples
                        </button>
                    </div>
                    
                    <div id="tsne-results" class="loading" style="display: none;">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Generating t-SNE visualizations... This may take a moment.</p>
                    </div>
                    
                    <div id="tsne-content"></div>
                </div>
            </div>

            <!-- Mathematical Background -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-calculator"></i> Mathematical Background</h3>
                </div>
                <div class="card-body">
                    <h4>Objective Function</h4>
                    <p>t-SNE minimizes the Kullback-Leibler divergence between two probability distributions:</p>
                    <p>$$\min_{Y} KL(P||Q) = \sum_{i,j} p_{ij} \log \frac{p_{ij}}{q_{ij}}$$</p>
                    
                    <h4>High-Dimensional Probabilities</h4>
                    <p>In high dimensions, similarities are converted to probabilities using Gaussian distributions:</p>
                    <p>$$p_{j|i} = \frac{\exp(-||x_i - x_j||^2 / 2\sigma_i^2)}{\sum_{k \neq i} \exp(-||x_i - x_k||^2 / 2\sigma_i^2)}$$</p>
                    
                    <h4>Low-Dimensional Probabilities</h4>
                    <p>In low dimensions, probabilities use t-distributions (heavier tails):</p>
                    <p>$$q_{ij} = \frac{(1 + ||y_i - y_j||^2)^{-1}}{\sum_{k \neq l} (1 + ||y_k - y_l||^2)^{-1}}$$</p>
                    
                    <h4>Gradient Descent</h4>
                    <p>The algorithm uses gradient descent to minimize the cost function:</p>
                    <p>$$\frac{\partial C}{\partial y_i} = 4 \sum_j (p_{ij} - q_{ij})(y_i - y_j)(1 + ||y_i - y_j||^2)^{-1}$$</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function loadTSNERandomExample() {
            const resultsDiv = document.getElementById('tsne-results');
            const contentDiv = document.getElementById('tsne-content');
            
            resultsDiv.style.display = 'block';
            contentDiv.innerHTML = '';
            
            try {
                const response = await fetch('/api/tsne-random-example');
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                resultsDiv.style.display = 'none';
                
                let html = '<div class="row">';
                
                for (const [key, result] of Object.entries(data)) {
                    const perplexity = result.perplexity;
                    html += `
                        <div class="col-md-6 mb-4">
                            <div class="visualization-container">
                                <h5>t-SNE with Perplexity = ${perplexity}</h5>
                                <img src="data:image/png;base64,${result.image}" class="visualization-image" alt="t-SNE perplexity ${perplexity}">
                                <div class="mt-3">
                                    <p><strong>Perplexity:</strong> ${perplexity}</p>
                                    <p><strong>Samples:</strong> ${result.n_samples}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                html += '</div>';
                
                // Add perplexity explanation
                html += `
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5><i class="fas fa-chart-pie"></i> Perplexity Analysis</h5>
                        </div>
                        <div class="card-body">
                            <p><strong>Key Insights:</strong></p>
                            <ul>
                                <li><strong>Perplexity 5:</strong> Very local focus, creates many small, tight clusters</li>
                                <li><strong>Perplexity 15:</strong> Balanced view, good for most datasets</li>
                                <li><strong>Perplexity 30:</strong> More global structure, fewer but larger clusters</li>
                                <li><strong>Perplexity 50:</strong> Very global view, emphasizes overall data structure</li>
                            </ul>
                            <p class="mt-3"><strong>Interpretation:</strong> The random dataset with 3 clusters shows how t-SNE preserves local neighborhoods while revealing global structure. Different perplexity values emphasize different aspects of the data!</p>
                        </div>
                    </div>
                `;
                
                contentDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.style.display = 'none';
                contentDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> Error loading t-SNE visualization: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>

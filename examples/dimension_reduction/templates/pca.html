<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCA - Principal Component Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        .page-title {
            color: #2c3e50;
            font-weight: 700;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .section-title {
            color: #34495e;
            font-weight: 600;
            margin-top: 30px;
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }
        
        .visualization-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .visualization-image {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .nav-link {
            color: #2c3e50;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .nav-link:hover {
            color: #3498db;
        }
        
        .beginner-guide {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
        }
        
        .use-case {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #27ae60;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .intuition-box {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #f39c12;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        
        .spinner-border {
            color: #3498db;
        }
        
        .comparison-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .comparison-table th {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-weight: 600;
            padding: 15px;
        }
        
        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
        
        .animation-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .animation-image {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .animation-stats {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .stat-box {
            text-align: center;
            padding: 10px;
        }
        
        .stat-box h6 {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .stat-box p {
            color: #3498db;
            font-weight: 700;
            font-size: 1.2rem;
            margin: 0;
        }
        
        .form-range {
            width: 100%;
        }
        
        .form-range::-webkit-slider-thumb {
            background: #3498db;
        }
        
        .form-range::-moz-range-thumb {
            background: #3498db;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <!-- Navigation -->
            <nav class="navbar navbar-expand-lg navbar-light mb-4">
                <div class="container-fluid">
                    <a class="navbar-brand" href="/">
                        <i class="fas fa-chart-line"></i> Dimension Reduction
                    </a>
                    <div class="navbar-nav ms-auto">
                        <a class="nav-link" href="/"><i class="fas fa-home"></i> Home</a>
                        <a class="nav-link" href="/svd"><i class="fas fa-cube"></i> SVD</a>
                        <a class="nav-link" href="/nnmf"><i class="fas fa-layer-group"></i> NNMF</a>
                        <a class="nav-link active" href="/pca"><i class="fas fa-compress"></i> PCA</a>
                        <a class="nav-link" href="/tsne"><i class="fas fa-project-diagram"></i> t-SNE</a>
                    </div>
                </div>
            </nav>

            <h1 class="page-title">
                <i class="fas fa-compress"></i> Principal Component Analysis (PCA)
            </h1>

            <!-- Beginner's Guide -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-graduation-cap"></i> Beginner's Guide to PCA</h3>
                </div>
                <div class="card-body">
                    <div class="beginner-guide">
                        <h4><i class="fas fa-lightbulb"></i> What is PCA?</h4>
                        <p><strong>Principal Component Analysis (PCA)</strong> is like finding the most important directions in your data. Imagine you have a cloud of points in 3D space - PCA finds the directions where the data spreads out the most.</p>
                        
                        <h5><i class="fas fa-analytics"></i> Simple Analogy:</h5>
                        <p>Think of PCA like taking a photo of a 3D object from different angles. Some angles show more detail and variation than others. PCA finds the "best angles" to view your data - the ones that capture the most information.</p>
                        
                        <h5><i class="fas fa-cogs"></i> How it Works:</h5>
                        <ol>
                            <li><strong>Find the direction of maximum variance</strong> - This is the first principal component</li>
                            <li><strong>Find the direction of second maximum variance</strong> - Perpendicular to the first, this is the second principal component</li>
                            <li><strong>Continue until you have enough components</strong> to explain most of the data</li>
                            <li><strong>Project your data</strong> onto these new directions</li>
                        </ol>
                        
                        <h5><i class="fas fa-eye"></i> Real-World Example:</h5>
                        <p>Imagine you're analyzing customer data with 100 features (age, income, spending habits, etc.). PCA might find that most variation comes from just 3 "super-features" that combine the original 100. These 3 components capture 90% of the information!</p>
                    </div>
                </div>
            </div>

            <!-- Intuition Behind PCA -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-brain"></i> Intuition Behind PCA</h3>
                </div>
                <div class="card-body">
                    <div class="intuition-box">
                        <h4><i class="fas fa-compass"></i> The Core Idea</h4>
                        <p>PCA is based on a simple but powerful idea: <strong>most of the information in high-dimensional data can be captured in fewer dimensions</strong> by finding the directions of maximum variance.</p>
                        
                        <h5><i class="fas fa-chart-scatter"></i> Geometric Intuition:</h5>
                        <ul>
                            <li><strong>Data Cloud:</strong> Your data points form a cloud in high-dimensional space</li>
                            <li><strong>Principal Axes:</strong> PCA finds the axes where this cloud is most "stretched"</li>
                            <li><strong>Information Preservation:</strong> These axes contain the most information about your data</li>
                            <li><strong>Dimensionality Reduction:</strong> You can ignore the axes with little variance</li>
                        </ul>
                        
                        <h5><i class="fas fa-balance-scale"></i> Variance = Information:</h5>
                        <p>In PCA, <strong>variance equals information</strong>. If data points vary a lot along a direction, that direction contains important information. If they don't vary much, that direction is less important.</p>
                        
                        <h5><i class="fas fa-magic"></i> The Magic:</h5>
                        <p>PCA automatically finds these important directions without you having to know what they are beforehand. It's like having a smart camera that automatically finds the best angle to photograph your data!</p>
                    </div>
                </div>
            </div>

            <!-- Where PCA is Used -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-globe"></i> Where is PCA Used?</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="use-case">
                                <h5><i class="fas fa-image"></i> Image Processing</h5>
                                <p><strong>Face Recognition:</strong> PCA reduces thousands of pixel values to just a few "eigenfaces" that capture the main variations in human faces.</p>
                                <p><strong>Image Compression:</strong> Reduce image size while keeping the most important visual information.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="use-case">
                                <h5><i class="fas fa-dna"></i> Bioinformatics</h5>
                                <p><strong>Gene Expression:</strong> Analyze thousands of genes by reducing them to a few principal components that explain most variation.</p>
                                <p><strong>Protein Structure:</strong> Understand protein folding patterns by finding the main structural components.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="use-case">
                                <h5><i class="fas fa-chart-line"></i> Finance</h5>
                                <p><strong>Risk Analysis:</strong> Reduce hundreds of financial indicators to a few key risk factors.</p>
                                <p><strong>Portfolio Optimization:</strong> Find the main sources of variation in stock prices.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="use-case">
                                <h5><i class="fas fa-microscope"></i> Scientific Research</h5>
                                <p><strong>Climate Data:</strong> Analyze weather patterns by reducing thousands of measurements to key climate components.</p>
                                <p><strong>Physics:</strong> Understand complex systems by finding their fundamental modes of variation.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PCA vs Other Methods -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-balance-scale"></i> PCA vs Other Methods</h3>
                </div>
                <div class="card-body">
                    <div class="comparison-table">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Method</th>
                                    <th>Type</th>
                                    <th>Best For</th>
                                    <th>Key Advantage</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>PCA</strong></td>
                                    <td>Linear</td>
                                    <td>Linear relationships, noise reduction</td>
                                    <td>Fast, interpretable, preserves global structure</td>
                                </tr>
                                <tr>
                                    <td><strong>SVD</strong></td>
                                    <td>Linear</td>
                                    <td>Matrix decomposition, data compression</td>
                                    <td>Mathematically elegant, handles any matrix</td>
                                </tr>
                                <tr>
                                    <td><strong>t-SNE</strong></td>
                                    <td>Non-linear</td>
                                    <td>Visualization, local structure</td>
                                    <td>Preserves local neighborhoods, great for visualization</td>
                                </tr>
                                <tr>
                                    <td><strong>NNMF</strong></td>
                                    <td>Linear</td>
                                    <td>Non-negative data, parts-based representation</td>
                                    <td>Interpretable components, additive model</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Visual Examples -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-chart-bar"></i> Visual Examples on Random Dataset</h3>
                </div>
                <div class="card-body">
                    <p class="mb-4">Let's see how PCA works on a random dataset with correlated features. We'll apply PCA with different numbers of components and see how the explained variance changes.</p>
                    
                    <div class="text-center mb-4">
                        <button class="btn btn-primary btn-lg" onclick="loadPCARandomExample()">
                            <i class="fas fa-play"></i> Generate Random PCA Examples
                        </button>
                    </div>
                    
                    <div id="pca-results" class="loading" style="display: none;">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Generating PCA visualizations...</p>
                    </div>
                    
                    <div id="pca-content"></div>
                </div>
            </div>

            <!-- Mathematical Background -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-calculator"></i> Mathematical Background</h3>
                </div>
                <div class="card-body">
                    <h4>Objective Function</h4>
                    <p>PCA finds the directions that maximize the variance of the projected data:</p>
                    <p>$$\max_{w} \text{Var}(Xw) = \max_{w} w^T \Sigma w$$</p>
                    <p>subject to: $||w|| = 1$</p>
                    
                    <h4>Solution</h4>
                    <p>The solution is given by the eigenvectors of the covariance matrix $\Sigma$:</p>
                    <p>$$\Sigma w = \lambda w$$</p>
                    <p>where $\lambda$ are the eigenvalues (variances) and $w$ are the eigenvectors (principal components).</p>
                    
                    <h4>Steps</h4>
                    <ol>
                        <li>Center the data: $X_{centered} = X - \mu$</li>
                        <li>Compute covariance matrix: $\Sigma = \frac{1}{n-1} X_{centered}^T X_{centered}$</li>
                        <li>Find eigenvalues and eigenvectors: $\Sigma = W \Lambda W^T$</li>
                        <li>Sort by eigenvalues (largest first)</li>
                        <li>Project data: $Y = X_{centered} W$</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let animationData = null;
        let animationInterval = null;
        let currentFrame = 0;
        
        // Animation controls
        async function loadPCARandomExample() {
            const resultsDiv = document.getElementById('pca-results');
            const contentDiv = document.getElementById('pca-content');
            
            resultsDiv.style.display = 'block';
            contentDiv.innerHTML = '';
            
            try {
                const response = await fetch('/api/pca-random-example');
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                resultsDiv.style.display = 'none';
                
                let html = '<div class="row">';
                
                for (const [key, result] of Object.entries(data)) {
                    const nComponents = key.split('_')[0];
                    html += `
                        <div class="col-md-6 mb-4">
                            <div class="visualization-container">
                                <h5>PCA with ${nComponents} Component${nComponents > 1 ? 's' : ''}</h5>
                                <img src="data:image/png;base64,${result.image}" class="visualization-image" alt="PCA ${nComponents} components">
                                <div class="mt-3">
                                    <p><strong>Explained Variance:</strong> ${(result.total_variance_explained * 100).toFixed(1)}%</p>
                                    <p><strong>Components:</strong> ${result.explained_variance_ratio.map((v, i) => `PC${i+1}: ${(v*100).toFixed(1)}%`).join(', ')}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                html += '</div>';
                
                // Add variance explanation
                html += `
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5><i class="fas fa-chart-pie"></i> Explained Variance Analysis</h5>
                        </div>
                        <div class="card-body">
                            <p><strong>Key Insights:</strong></p>
                            <ul>
                                <li><strong>1 Component:</strong> Captures the most important pattern in the data</li>
                                <li><strong>2 Components:</strong> Adds the second most important direction (orthogonal to the first)</li>
                                <li><strong>3+ Components:</strong> Each additional component captures less and less variance</li>
                                <li><strong>Diminishing Returns:</strong> After a few components, adding more doesn't help much</li>
                            </ul>
                            <p class="mt-3"><strong>Interpretation:</strong> The random dataset shows how PCA finds the main directions of variation. With correlated features, PCA can capture most of the information with just a few components!</p>
                        </div>
                    </div>
                `;
                
                contentDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.style.display = 'none';
                contentDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> Error loading PCA visualization: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVD Mathematical Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 20px;
            padding: 30px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        
        .header h1 {
            color: #333;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .math-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border-left: 5px solid #667eea;
        }
        
        .step-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }
        
        .matrix-display {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            text-align: center;
            border: 2px solid #e9ecef;
        }
        
        .formula-large {
            font-size: 2em;
            text-align: center;
            color: #667eea;
            font-weight: bold;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn-custom {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            color: white;
        }
        
        .calculation-step {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid #e9ecef;
        }
        
        .calculation-step h5 {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .result-highlight {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .nav-link {
            color: #667eea;
            font-weight: 600;
        }
        
        .nav-link:hover {
            color: #764ba2;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <div class="header">
                <h1><i class="fas fa-calculator"></i> SVD Mathematical Details</h1>
                <p>Complete mathematical derivation with 2√ó2 example</p>
                <nav class="nav justify-content-center">
                    <a class="nav-link" href="/"><i class="fas fa-home"></i> Home</a>
                    <a class="nav-link" href="/svd"><i class="fas fa-cube"></i> SVD Visualization</a>
                    <a class="nav-link" href="/nnmf"><i class="fas fa-layer-group"></i> NNMF Visualization</a>
                    <a class="nav-link" href="/nnmf-math"><i class="fas fa-calculator"></i> NNMF Mathematics</a>
                    <a class="nav-link" href="/pca"><i class="fas fa-compress"></i> PCA</a>
                    <a class="nav-link" href="/tsne"><i class="fas fa-project-diagram"></i> t-SNE</a>
                    <a class="nav-link" href="#theory">Theory</a>
                    <a class="nav-link" href="#example">2√ó2 Example</a>
                    <a class="nav-link" href="#calculations">Step-by-Step</a>
                </nav>
            </div>
            
            <div class="math-section">
                <h2><i class="fas fa-graduation-cap"></i> What is SVD? (Beginner's Guide)</h2>
                
                <div class="step-box">
                    <button class="btn btn-outline-primary w-100 mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#beginnerExplanation" aria-expanded="false" aria-controls="beginnerExplanation">
                        <i class="fas fa-info-circle"></i> Click here to learn what SVD is (for beginners)
                    </button>
                    
                    <div class="collapse" id="beginnerExplanation">
                        <div class="card card-body">
                            <h5>üéØ What is Singular Value Decomposition (SVD)?</h5>
                            
                            <h6>üìö Simple Analogy:</h6>
                            <p>Imagine you have a complex machine (matrix) and you want to understand how it works. SVD is like taking apart the machine into three simple, understandable parts: the "input directions" (V), the "scaling factors" (Œ£), and the "output directions" (U).</p>
                            
                            <h6>üî¢ In Mathematical Terms:</h6>
                            <p>You have a data table (matrix), and SVD breaks it down into three special tables that, when multiplied together, recreate the original data perfectly.</p>
                            
                            <h6>üé® Real-World Example:</h6>
                            <p><strong>Image Compression:</strong> If you have a photo, SVD can find the most important "patterns" in the image and represent the photo using just a few key patterns instead of all the pixels.</p>
                            
                            <h6>üéµ Music Example:</h6>
                            <p><strong>Audio Processing:</strong> If you have a song, SVD can separate it into the main melody, rhythm, and harmonics - the fundamental components that make up the music.</p>
                            
                            <h6>üìä Why "Singular Values"?</h6>
                            <p>The "singular values" tell you how important each pattern is:</p>
                            <ul>
                                <li>üî¥ Large singular value: This pattern is very important</li>
                                <li>üü° Medium singular value: This pattern is somewhat important</li>
                                <li>üü¢ Small singular value: This pattern is less important (can be ignored)</li>
                            </ul>
                            
                            <h6>üéØ What Does SVD Do?</h6>
                            <ol>
                                <li><strong>Finds Principal Directions:</strong> Discovers the most important directions in your data</li>
                                <li><strong>Ranks Importance:</strong> Tells you which directions matter most</li>
                                <li><strong>Enables Compression:</strong> Keeps only the important parts, throws away the rest</li>
                                <li><strong>Removes Noise:</strong> Filters out unimportant variations</li>
                            </ol>
                            
                            <h6>üîç Step-by-Step Process:</h6>
                            <ol>
                                <li><strong>Start:</strong> You have a data table (matrix)</li>
                                <li><strong>Find Patterns:</strong> Calculate A^T A to find the input directions</li>
                                <li><strong>Get Eigenvalues:</strong> Find the scaling factors (how important each pattern is)</li>
                                <li><strong>Get Eigenvectors:</strong> Find the actual pattern directions</li>
                                <li><strong>Calculate U:</strong> Find the output directions</li>
                                <li><strong>Reconstruct:</strong> Multiply U Œ£ V^T to get back your original data</li>
                            </ol>
                            
                            <h6>üí° Why Is This Useful?</h6>
                            <ul>
                                <li><strong>Data Compression:</strong> Store 1000 photos as 10 patterns</li>
                                <li><strong>Noise Reduction:</strong> Remove unimportant details</li>
                                <li><strong>Pattern Recognition:</strong> Find hidden structures in data</li>
                                <li><strong>Dimensionality Reduction:</strong> Reduce complex data to simple components</li>
                            </ul>
                            
                            <h6>üéì TLDR:</h6>
                            <p>Think of SVD as the "ultimate factorization" - it works for any matrix (unlike other methods). It's like finding the "DNA" of your data - the fundamental building blocks that explain everything.</p>
                            
                            <h6>üî¨ The Three Components:</h6>
                            <ul>
                                <li><strong>U (Left Singular Vectors):</strong> "How the outputs are organized"</li>
                                <li><strong>Œ£ (Singular Values):</strong> "How important each pattern is"</li>
                                <li><strong>V^T (Right Singular Vectors):</strong> "How the inputs are organized"</li>
                            </ul>
                            
                            <div class="alert alert-info mt-3">
                                <strong>üí° Key Takeaway:</strong> SVD takes any data and finds the most important patterns, ranked by importance. It's like finding the "essence" of your data!
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="theory" class="math-section">
                <h2><i class="fas fa-book"></i> Mathematical Theory</h2>
                
                <h4>What is SVD?</h4>
                <p>Singular Value Decomposition (SVD) decomposes any matrix $A$ into three matrices:</p>
                
                <div class="formula-large">
                    $A = U \Sigma V^T$
                </div>
                
                <h5>Where:</h5>
                <ul>
                    <li><strong>$U$</strong>: Left singular vectors (orthogonal matrix)</li>
                    <li><strong>$\Sigma$</strong>: Singular values (diagonal matrix)</li>
                    <li><strong>$V^T$</strong>: Right singular vectors transposed (orthogonal matrix)</li>
                </ul>
                
                <h4>Key Properties:</h4>
                <ul>
                    <li>$U^T U = I$ (U is orthogonal)</li>
                    <li>$V^T V = I$ (V is orthogonal)</li>
                    <li>$\sigma_1 \geq \sigma_2 \geq \ldots \geq \sigma_r \geq 0$ (singular values are non-negative and ordered)</li>
                </ul>
                
                <h4>How to Compute SVD:</h4>
                <div class="step-box">
                    <h5>Step 1: Compute $A^T A$</h5>
                    <p>Find the Gram matrix $A^T A$</p>
                </div>
                
                <div class="step-box">
                    <h5>Step 2: Find Eigenvalues and Eigenvectors</h5>
                    <p>Solve the eigenvalue problem: $(A^T A) v = \lambda v$</p>
                    <p>This gives us eigenvalues $\lambda_i$ and eigenvectors $v_i$</p>
                </div>
                
                <div class="step-box">
                    <h5>Step 3: Compute Singular Values</h5>
                    <p>$\sigma_i = \sqrt{\lambda_i}$ (singular values are square roots of eigenvalues)</p>
                </div>
                
                <div class="step-box">
                    <h5>Step 4: Construct V Matrix</h5>
                    <p>$V = [v_1, v_2, \ldots, v_n]$ (right singular vectors)</p>
                </div>
                
                <div class="step-box">
                    <h5>Step 5: Construct U Matrix</h5>
                    <p>$U = A V \Sigma^{-1}$ (left singular vectors)</p>
                </div>
                
                <div class="step-box">
                    <h5>Step 6: Verify Reconstruction</h5>
                    <p>Check that $A = U \Sigma V^T$</p>
                </div>
            </div>
            
            <div id="example" class="math-section">
                <h2><i class="fas fa-cube"></i> 2√ó2 Example</h2>
                <p>Let's work through a complete example with matrix:</p>
                
                <div class="matrix-display" id="matrix-A">
                    <h5>Matrix A:</h5>
                    <div id="matrix-A-content">Loading...</div>
                </div>
                
                <button class="btn btn-custom" onclick="loadExample()">
                    <i class="fas fa-play"></i> Compute SVD Step by Step
                </button>
                
                <div id="calculations" style="display: none;">
                    <h3><i class="fas fa-list-ol"></i> Complete Step-by-Step Calculations</h3>
                    
                    <div class="calculation-step">
                        <h5 id="step1-title">Step 1: Compute A^T A</h5>
                        <p id="step1-description"></p>
                        <div class="matrix-display">
                            <div id="step1-calculation"></div>
                        </div>
                        <div class="matrix-display">
                            <div id="step1-result"></div>
                        </div>
                    </div>
                    
                    <div class="calculation-step">
                        <h5 id="step2-title">Step 2: Find Eigenvalues</h5>
                        <p id="step2-description"></p>
                        <div class="matrix-display">
                            <div id="step2-calculation"></div>
                        </div>
                        <div class="matrix-display">
                            <div id="step2-expansion"></div>
                        </div>
                        <div class="matrix-display">
                            <div id="step2-quadratic"></div>
                        </div>
                        <div class="matrix-display">
                            <div id="step2-quadratic-simplified"></div>
                        </div>
                        <div class="result-highlight">
                            <div id="step2-eigenvalues"></div>
                        </div>
                    </div>
                    
                    <div class="calculation-step">
                        <h5 id="step3-title">Step 3: Find Eigenvectors</h5>
                        <p id="step3-description"></p>
                        
                        <h6>For $\lambda_1$:</h6>
                        <div class="matrix-display">
                            <div id="step3-eigenvector1-equation"></div>
                        </div>
                        <div class="matrix-display">
                            <div id="step3-eigenvector1-matrix"></div>
                        </div>
                        <div class="result-highlight">
                            <div id="step3-eigenvector1-solution"></div>
                        </div>
                        
                        <h6>For $\lambda_2$:</h6>
                        <div class="matrix-display">
                            <div id="step3-eigenvector2-equation"></div>
                        </div>
                        <div class="matrix-display">
                            <div id="step3-eigenvector2-matrix"></div>
                        </div>
                        <div class="result-highlight">
                            <div id="step3-eigenvector2-solution"></div>
                        </div>
                    </div>
                    
                    <div class="calculation-step">
                        <h5 id="step4-title">Step 4: Compute Singular Values</h5>
                        <p id="step4-description"></p>
                        <div class="matrix-display">
                            <div id="step4-calculation1"></div>
                        </div>
                        <div class="matrix-display">
                            <div id="step4-calculation2"></div>
                        </div>
                        <div class="matrix-display">
                            <div id="step4-sigma-matrix"></div>
                        </div>
                    </div>
                    
                    <div class="calculation-step">
                        <h5 id="step5-title">Step 5: Construct V Matrix</h5>
                        <p id="step5-description"></p>
                        <div class="matrix-display">
                            <div id="step5-calculation"></div>
                        </div>
                    </div>
                    
                    <div class="calculation-step">
                        <h5 id="step6-title">Step 6: Construct U Matrix</h5>
                        <p id="step6-description"></p>
                        <div class="matrix-display">
                            <div id="step6-calculation"></div>
                        </div>
                        <div class="result-highlight">
                            <div id="step6-result"></div>
                        </div>
                    </div>
                    
                    <div class="calculation-step">
                        <h5 id="step7-title">Step 7: Verify Reconstruction</h5>
                        <p id="step7-description"></p>
                        <div class="matrix-display">
                            <div id="step7-calculation"></div>
                        </div>
                        <div class="result-highlight">
                            <div id="step7-result"></div>
                        </div>
                        <div class="result-highlight">
                            <div id="step7-error"></div>
                        </div>
                    </div>
                    
                    <div class="result-highlight">
                        <h4>Final SVD Decomposition:</h4>
                        <div id="final-result"></div>
                    </div>
                </div>
            </div>
            
            <div class="math-section">
                <h2><i class="fas fa-lightbulb"></i> Key Insights</h2>
                
                <h4>What are Eigenvalues?</h4>
                <p>Eigenvalues $\lambda$ are scalars that satisfy the equation:</p>
                <div class="formula-large">$A v = \lambda v$</div>
                <p>They represent how much a vector is "stretched" or "compressed" when multiplied by the matrix.</p>
                
                <h4>What are Eigenvectors?</h4>
                <p>Eigenvectors $v$ are non-zero vectors that satisfy:</p>
                <div class="formula-large">$A v = \lambda v$</div>
                <p>They represent the directions that are preserved under the linear transformation.</p>
                
                <h4>Why SVD Works:</h4>
                <ul>
                    <li><strong>Orthogonality</strong>: U and V are orthogonal, meaning they preserve lengths and angles</li>
                    <li><strong>Diagonal Structure</strong>: Œ£ contains only singular values on the diagonal</li>
                    <li><strong>Optimal Approximation</strong>: SVD gives the best low-rank approximation of any matrix</li>
                    <li><strong>Uniqueness</strong>: The singular values are unique (up to ordering)</li>
                </ul>
                
                <h4>Applications:</h4>
                <ul>
                    <li><strong>Data Compression</strong>: Keep only the most important components</li>
                    <li><strong>Noise Reduction</strong>: Remove components with small singular values</li>
                    <li><strong>Principal Component Analysis</strong>: Find the most important directions in data</li>
                    <li><strong>Recommendation Systems</strong>: Factor user-item matrices</li>
                    <li><strong>Image Processing</strong>: Compress and denoise images</li>
                </ul>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function loadExample() {
            try {
                const response = await fetch('/api/math-example');
                const data = await response.json();
                
                // Display matrix A
                document.getElementById('matrix-A-content').innerHTML = 
                    `$$A = \\begin{bmatrix} ${data.matrix_A[0][0]} & ${data.matrix_A[0][1]} \\\\ ${data.matrix_A[1][0]} & ${data.matrix_A[1][1]} \\end{bmatrix}$$`;
                
                const steps = data.detailed_steps;
                
                // Step 1: A^T A
                document.getElementById('step1-title').textContent = steps.step1.title;
                document.getElementById('step1-description').textContent = steps.step1.description;
                document.getElementById('step1-calculation').innerHTML = 
                    `<strong>Step 1a:</strong> \\[${steps.step1.step1a}\\]<br><br>
                     <strong>Step 1b:</strong> \\[${steps.step1.step1b}\\]<br><br>
                     <strong>Step 1c:</strong> \\[${steps.step1.step1c}\\]<br><br>
                     <strong>Step 1d:</strong> \\[${steps.step1.step1d}\\]<br><br>
                     <strong>Step 1e:</strong> \\[${steps.step1.step1e}\\]`;
                document.getElementById('step1-result').innerHTML = `\\[${steps.step1.step1e}\\]`;
                
                // Step 2: Eigenvalues
                document.getElementById('step2-title').textContent = steps.step2.title;
                document.getElementById('step2-description').textContent = steps.step2.description;
                document.getElementById('step2-calculation').innerHTML = 
                    `<strong>Step 2a:</strong> \\[${steps.step2.step2a}\\]<br><br>
                     <strong>Step 2b:</strong> \\[${steps.step2.step2b}\\]<br><br>
                     <strong>Step 2c:</strong> \\[${steps.step2.step2c}\\]<br><br>
                     <strong>Step 2d:</strong> \\[${steps.step2.step2d}\\]<br><br>
                     <strong>Step 2e:</strong> \\[${steps.step2.step2e}\\]<br><br>
                     <strong>Step 2f:</strong> \\[${steps.step2.step2f}\\]<br><br>
                     <strong>Step 2g:</strong> \\[${steps.step2.step2g}\\]<br><br>
                     <strong>Step 2h:</strong> \\[${steps.step2.step2h}\\]<br><br>
                     <strong>Step 2i:</strong> \\[${steps.step2.step2i}\\]<br><br>
                     <strong>Step 2j:</strong> \\[${steps.step2.step2j}\\]`;
                document.getElementById('step2-expansion').innerHTML = `\\[${steps.step2.step2b}\\]`;
                document.getElementById('step2-quadratic').innerHTML = `\\[${steps.step2.step2d}\\]`;
                document.getElementById('step2-quadratic-simplified').innerHTML = `\\[${steps.step2.step2f}\\]`;
                document.getElementById('step2-eigenvalues').innerHTML = `\\[${steps.step2.step2i}\\] and \\[${steps.step2.step2j}\\]`;
                
                // Step 3: Eigenvectors
                document.getElementById('step3-title').textContent = steps.step3.title;
                document.getElementById('step3-description').textContent = steps.step3.description;
                
                document.getElementById('step3-eigenvector1-equation').innerHTML = `$$${steps.step3.eigenvector1.equation}$$`;
                document.getElementById('step3-eigenvector1-matrix').innerHTML = `$$${steps.step3.eigenvector1.matrix}$$`;
                document.getElementById('step3-eigenvector1-solution').innerHTML = `$$${steps.step3.eigenvector1.solution}$$`;
                
                document.getElementById('step3-eigenvector2-equation').innerHTML = `$$${steps.step3.eigenvector2.equation}$$`;
                document.getElementById('step3-eigenvector2-matrix').innerHTML = `$$${steps.step3.eigenvector2.matrix}$$`;
                document.getElementById('step3-eigenvector2-solution').innerHTML = `$$${steps.step3.eigenvector2.solution}$$`;
                
                // Step 4: Singular values
                document.getElementById('step4-title').textContent = steps.step4.title;
                document.getElementById('step4-description').textContent = steps.step4.description;
                document.getElementById('step4-calculation1').innerHTML = `$$${steps.step4.calculation}$$`;
                document.getElementById('step4-calculation2').innerHTML = `$$${steps.step4.calculation2}$$`;
                document.getElementById('step4-sigma-matrix').innerHTML = `$$${steps.step4.sigma_matrix}$$`;
                
                // Step 5: V matrix
                document.getElementById('step5-title').textContent = steps.step5.title;
                document.getElementById('step5-description').textContent = steps.step5.description;
                document.getElementById('step5-calculation').innerHTML = `$$${steps.step5.calculation}$$`;
                
                // Step 6: U matrix
                document.getElementById('step6-title').textContent = steps.step6.title;
                document.getElementById('step6-description').textContent = steps.step6.description;
                document.getElementById('step6-calculation').innerHTML = `$$${steps.step6.calculation}$$`;
                document.getElementById('step6-result').innerHTML = `$$${steps.step6.result}$$`;
                
                // Step 7: Verification
                document.getElementById('step7-title').textContent = steps.step7.title;
                document.getElementById('step7-description').textContent = steps.step7.description;
                document.getElementById('step7-calculation').innerHTML = `$$${steps.step7.calculation}$$`;
                document.getElementById('step7-result').innerHTML = `$$${steps.step7.result}$$`;
                document.getElementById('step7-error').innerHTML = `$$${steps.step7.error}$$`;
                
                // Final result
                const U = data.matrix_U;
                const singvals = data.singular_values;
                const eigenvecs = data.eigenvectors;
                document.getElementById('final-result').innerHTML = 
                    `$$A = \\begin{bmatrix} ${U[0][0].toFixed(4)} & ${U[0][1].toFixed(4)} \\\\ ${U[1][0].toFixed(4)} & ${U[1][1].toFixed(4)} \\end{bmatrix} \\begin{bmatrix} ${singvals[0].toFixed(4)} & 0 \\\\ 0 & ${singvals[1].toFixed(4)} \\end{bmatrix} \\begin{bmatrix} ${eigenvecs[0][0].toFixed(4)} & ${eigenvecs[1][0].toFixed(4)} \\\\ ${eigenvecs[0][1].toFixed(4)} & ${eigenvecs[1][1].toFixed(4)} \\end{bmatrix}$$`;
                
                // Show calculations
                document.getElementById('calculations').style.display = 'block';
                
                // Re-render MathJax
                MathJax.typesetPromise();
                
            } catch (error) {
                console.error('Error loading example:', error);
                alert('Error loading mathematical example: ' + error.message);
            }
        }
        
        // Load initial matrix display
        window.onload = function() {
            document.getElementById('matrix-A-content').innerHTML = 
                `$$A = \\begin{bmatrix} 3 & 1 \\\\ 1 & 3 \\end{bmatrix}$$`;
            MathJax.typesetPromise();
        };
    </script>
</body>
</html>
